import socket
import hashlib
from appgame import TriviaServer

def login_usuario(conn):
    opcion, email, contrasena = conn.recv(1024).decode().split(',')
    hashed_password = hashlib.sha256(contrasena.encode()).hexdigest()

    if opcion == '1':
        with open('usuarios.txt', 'r') as f:
            usuarios = f.read().splitlines()
            for usuario in usuarios:
                if usuario == f"{email},{hashed_password}":
                    conn.send("OK".encode())
                    return True
            conn.send("Correo electr칩nico o contrase침a incorrectos.".encode())
    elif opcion == '2':
        with open('usuarios.txt', 'r') as f:
            usuarios = f.read().splitlines()
            for usuario in usuarios:
                if usuario.split(',')[0] == email:
                    conn.send("El correo electr칩nico ya est치 registrado.".encode())
                    return
        with open('usuarios.txt', 'a') as f:
            f.write(f"{email},{hashed_password}\n")
            conn.send("OK".encode())
            return True
    return False

def iniciar_servidor():
    server = TriviaServer()
    server.start()

if __name__ == "__main__":
    iniciar_servidor()
